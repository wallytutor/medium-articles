<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="/medium-articles/libs/katex/katex.min.css">
     
   <link rel="stylesheet" href="/medium-articles/libs/highlight/styles/github.min.css">
   
  <link rel="stylesheet" href="/medium-articles/css/franklin.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic|Source+Code+Pro:400,700" type="text/css">
<link rel="stylesheet" href="/medium-articles/css/font-awesome.min.css">
<link rel="stylesheet" href="/medium-articles/css/celeste.min.css">
<link rel="stylesheet" href="/medium-articles/css/custom.css">

<link rel="icon" type="image/png" sizes="192x192" href="/medium-articles/assets/favicon.png">
<link rel="shortcut icon" href="/medium-articles/assets/favicon.ico">


   <title>Breakdown into sub-models</title>  
</head>
<body>
  <header>
<nav class="nav-main">
  <ul>
    <li class="logo"><a class="hvr-ripple-out" href="/medium-articles/">W</a></li>
    <li class="hvr-underline-reveal"><a href="/medium-articles/content/medium/">Medium Articles</a></li>
    <li class="hvr-underline-reveal"><a href="/medium-articles/content/transport-phenomena/">Transport Phenomena</a></li>
    <li class="hvr-underline-reveal"><a href="/medium-articles/content/julia-para-cientistas/">Julia para Cientistas</a></li>
    <li class="hvr-underline-reveal"><a href="/medium-articles/content/engenharia-de-reatores/">Engenharia de Reatores</a></li>
    <li class="hvr-underline-reveal"><a href="/medium-articles/content/bookmarks/">Links</a></li>
  </ul>
</nav>
</header>


<!-- Content appended here -->
<div class="franklin-content"><h2 id="breakdown_into_sub-models"><a href="#breakdown_into_sub-models" class="header-anchor">Breakdown into sub-models</a></h2>
<ul>
<li><p>&#91;x&#93; Incompressible flow only for mesh and conditions check with <code>incompressibleFluid</code>:</p>
</li>
</ul>
<p>- After a first run with a system length of 1 m it was decided to increase the domain to 2 m in order to ensure a better development of flow profile &#40;at least 10 times the cross section size&#41; and double the number of cells in transversal directions.
- It was confirmed that the inlet mean velocity profile respects the expected value from the imposed mass flow rate evaluated during parameters setup, but outlet is controversial. This is probably because the case should be run as turbulent or grid is too coarse.
- Mass conservation was monitored and confirmed through field <code>phi</code>.
- It must be emphasized that boundary layer resolution is not accurate since no grading is applied and mesh is very coarse, but since the goal is flare development far from the walls this is acceptable at this stage and will be dealt with at a later stage.
- All residuals are going down adequately, allowing us to move to the next step. 
- Calculation took approximately 10 seconds with 1 core.</p>
<ul>
<li><p>&#91;x&#93; Previous case is copied and support to RAS \(k-\varepsilon\) &#40;&#91;&#91;@Launder1974&#93;&#93;&#41; is implemented:</p>
</li>
</ul>
<p>- With inclusion of turbulence the actual outlet velocity matches the expected value &#40;that was unphysical in the previous simulation&#41;, validating the approach.
- Entry length is verified through velocity and turbulent viscosity, confirming the need to extend the domain for a proper development.
- The number of iterations was increased to 200 to ensure that everything has properly converged, reaching an extremely low residuals level for all variables.
- Other previous observations are still valid, allowing us to move to the next step.
- Calculation took approximately 11 seconds with 1 core to perform 100 iterations. After 100 iterations the step convergence becomes slow because of the already low residuals, leading to a calculation time of 38 seconds.</p>
<ul>
<li><p>&#91;x&#93; Adding compressible flow with <code>multicomponentFluid</code> to the above:</p>
</li>
</ul>
<p>- The temperature field is added prior to handling any combustion aspects in this step to avoid having interaction between these elements in convergence checks. 
- Nonetheless, gravity was already added here after a first run without it for a basic check. A vertical pressure profile is observed in the cross-section, showing the expected buoyancy effects.
- Other Impacted files include physical properties, which now incorporate more detailed thermodynamics, <code>alphat</code> and, at least, the main chemical component file with boundary and initial conditions. 
- The mean value of <code>phi</code> in the outlet can now be compared to the imposed mass flow rate, validating the boundary condition setup.
- Calculation took approximately 13 seconds with 1 core to perform 100 iterations. Again an important slow down is observed leading to 125 seconds to perform 300 iterations.</p>
<ul>
<li><p>&#91; &#93; The next logical step is to include evaporation of fuel in the gas, without enabling reactions:</p>
</li>
</ul>
<p>- The simples way of doing so is adding the required chemical and associated initial file without adding any combustion or reaction parameters. It was chosen to use the actual species name instead of simply *fuel* to keep created files compatible with next steps. Simulation was checked before adding the cloud, which exponentially complexifies the setup.
- A <code>patchPostProcessing</code> cloud function was tested at first to check if conditions were leading to complete fuel evaporation. It is kept commented-out for future debug if required. To make results easier to interpret, a fixed size PSD was adopted at this stage.
- As expected, convergence is bad and the only strategy that seems to work is mesh refinement. Otherwise pressure coupling becomes difficult and trying to change numerical parameters &#40;solver correctors, linear solver, divergence and Laplacian schemes, relaxation level&#41; do not improve anything. Tried to use <code>SOI</code> at a later iteration to let flow converge before injection, but apparently the steady solver ignores this. Even with <code>localEuler</code> pseudo-time stepping &#40;requires to add residuals for <code>rho</code> in <code>fvSolution</code>&#41; it does not seem to take <code>SOI</code> into account.  Also tried deactivating clouds and converging before reactivating it &#40;what would be equivalent to the later <code>SOI</code> approach&#41; and that does not work either, confirming it is a physical coupling problem.
- Because of mesh refinement, now parallelization becomes a requirement unless we work with mesh grading, what is out of the present scope &#40;to be done only in production scenario&#41;.</p>
<h2 id="future_improvements"><a href="#future_improvements" class="header-anchor">Future improvements</a></h2>
<ul>
<li><p>&#91; &#93; Add the following to the parameters file for full turbulence model controls:</p>
</li>
</ul>
<pre><code class="language-C">Cmu             0.09;
C1              1.44;
C2              1.92;
C3              0;
sigmak          1;
sigmaEps        1.3;</code></pre>
<ul>
<li><p>&#91; &#93; Add convergence criteria <code>PIMPLE: No convergence criteria found</code>.</p>
</li>
<li><p>&#91; &#93; Consider a possible adaptive mesh refinement at case setup &#40;not runtime&#33;&#41;.</p>
</li>
</ul>
<h2 id="reminders"><a href="#reminders" class="header-anchor">Reminders</a></h2>
<ul>
<li><p>Because of <code>potentialFlow</code> initialization, a dictionary corresponding to this must be present in <code>fvSolution</code> as well as a solver for <code>Phi</code> &#40;copy defaults for pressure&#41;. Because this solver does not have information about temperature or composition of fluid, a field <code>rhoInlet</code> is required in inlets.</p>
</li>
</ul>
<h2 id="initial_tentative_setup"><a href="#initial_tentative_setup" class="header-anchor">Initial tentative setup</a></h2>
<ul>
<li><p>This case aims producing a steady state liquid fuel combustion model using <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/aachenBomb">aachenBomb</a> case as a starting point, but does not directly tries to reproduce the results of that case. It was modified so that there is an inlet and an outlet for flame development.</p>
</li>
<li><p>To perform the setup we retrieve several modifications from <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/verticalChannelSteady">verticalChannelSteady</a> and <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/verticalChannelLTS">verticalChannelLTS</a>. The first because it is the only case under <code>multicomponentFluid</code> solver currently using a <code>steadyState</code> time-stepping scheme and the latter due to the use of <code>localEuler</code>, which is often used to produce pseudo-steady solutions when a direct steady state calculations becomes unstable &#40;as it is the case in most combustion calculations&#41;.</p>
</li>
<li><p>Modify <code>controlDict</code> to integer steps &#40;that is, each step is an iteration&#41; for both time-step and write controls, and enable <code>purgeWrite</code> to keep case cleaner. Notice that this is also valid if using a <code>localEuler</code> time-stepping scheme.  Change time-stepping method accordingly in <code>fvSchemes</code>.</p>
</li>
<li><p>To increase robustness of solution, it is recommended to compute a potential flow with <code>potentialFoam</code> as in reference case <a href="https://github.com/OpenFOAM/OpenFOAM-11/tree/master/tutorials/multicomponentFluid/verticalChannelLTS">verticalChannelLTS</a>. This requires a solver control field <code>Phi</code> in <code>fvSolution</code> and a  reference <code>rhoInlet</code> value to be provided in inlet flow velocity. Other parameters, but specially <code>maxCo</code> are also copied from reference case.</p>
</li>
<li><p>Some dictionaries in <code>cloudProperties</code> require steady-state specific commands, such as adding <code>calcFrequency</code> to <code>solution</code>, <code>resetOnStartup</code> to <code>solution.sourceTerms</code>, and injection models must use <code>massFlowRate</code>, what is physically understandable.</p>
</li>
<li><p>Combustion is quite sensitive and Seulex alone does not seem able to handle it with an <code>EDC</code> approach. First flow was developed further during 100 steps before activating chemistry. For now using a single step <code>infinitelyFastChemistry</code> to try to stabilize the behavior before trying back to use the <code>EDC</code> model.</p>
</li>
</ul>
<div class="page-foot">
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Walter Dal'Maz Silva -
    Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    
        <script src="/medium-articles/libs/katex/katex.min.js"></script>
<script src="/medium-articles/libs/katex/contrib/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

    
    
        <script src="/medium-articles/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>

    
  </body>
</html>
